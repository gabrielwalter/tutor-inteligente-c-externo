<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Inteligente de C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .font-mono { 
            font-family: 'Fira Code', monospace; 
        }
        
        /* Estilos das abas melhorados */
        .tab-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border-radius: 0;
        }
        
        .tab-button:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-1px);
        }
        
        .tab-button.tab-active { 
            background: linear-gradient(135deg, #6d28d9 0%, #4f46e5 100%);
            color: white;
            position: relative;
            box-shadow: 0 4px 15px rgba(109, 40, 217, 0.4);
        }
        
        .tab-button.tab-active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 2px;
        }
        
        /* Container das abas */
        .tab-container {
            background: white;
            border-radius: 16px 16px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }
        
        /* Conte√∫do das abas */
        .tab-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 0 0 16px 16px;
            min-height: 400px;
        }
        
        .view { 
            display: none; 
        }
        
        .view-active { 
            display: block; 
            animation: fadeIn 0.5s ease-in-out; 
        }
        
        @keyframes fadeIn { 
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        
        .lepees-label { 
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            color: #5b21b6; 
            font-weight: 800; 
            border-radius: 50%; 
            width: 40px; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0; 
            font-size: 1.25rem;
            box-shadow: 0 2px 8px rgba(91, 33, 182, 0.2);
        }
        
        /* Estilos para o v√≠deo profissional */
        .video-container {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px;
        }
        
        .video-inner {
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: #000;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(109, 40, 217, 0.05), rgba(79, 70, 229, 0.05));
            pointer-events: none;
            z-index: 1;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .feature-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .quick-action-btn {
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* Estilo para o v√≠deo com autoplay */
        .hero-video {
            position: relative;
        }

        .hero-video video {
            transition: all 0.3s ease;
        }

        .hero-video:hover video {
            transform: scale(1.02);
        }

        /* Cards com gradientes */
        .gradient-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .gradient-card-blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .gradient-card-green {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        /* Inputs melhorados */
        .modern-input {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .modern-input:focus {
            border-color: #6d28d9;
            box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.1);
        }

        /* Bot√µes melhorados */
        .modern-button {
            background: linear-gradient(135deg, #6d28d9 0%, #4f46e5 100%);
            transition: all 0.3s ease;
        }

        .modern-button:hover {
            background: linear-gradient(135deg, #5b21b6 0%, #4338ca 100%);
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(109, 40, 217, 0.3);
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div id="app" class="max-w-6xl mx-auto">
        <!-- HEADER -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
             <div class="flex items-center gap-4 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-violet-600"><path d="M15 14c.2-1 .7-1.7 1.5-2.5C17.3 10.7 18 9.9 18 9c0-.9-.4-1.8-1-2.4c-.9-.8-2-1.3-3.3-1.5c-.5-.1-.9.4-.8.9c.1.4.5.7.9.8c.8.2 1.5.6 2.1 1.2c.4.4.6 1 .6 1.6c0 .5-.2 1-.8 1.5c-.7.6-1.2 1.2-1.4 2.2c-.2.7.3 1.3.9 1.3h.2c.8 0 1.2-.8 1-1.5z"/><path d="M9 14c-.2-1-.7-1.7-1.5-2.5C6.7 10.7 6 9.9 6 9c0-.9.4-1.8 1-2.4c.9-.8 2-1.3 3.3-1.5c.5-.1.9.4.8.9c-.1.4-.5.7-.9.8c-.8.2-1.5.6-2.1 1.2c-.4.4-.6 1-.6 1.6c0 .5.2 1 .8 1.5c.7.6 1.2 1.2 1.4 2.2c.2.7-.3 1.3-.9 1.3H9c-.8 0-1.2-.8-1-1.5z"/><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/></svg>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Britney can C you!</h1>
                    <p class="text-gray-600">M√©todo LEPEEs para provas, criado por gabrielhando para todos, todas e tads :)</p>
                </div>
            </div>
             <div class="bg-gradient-to-r from-violet-600 to-indigo-600 text-white rounded-lg p-4">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <p id="current-date" class="text-sm opacity-90"></p>
                        <p id="exam-countdown" class="font-bold text-lg"></p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm opacity-90">Foco Principal:</p>
                        <p class="font-bold">a volta de Britney Spears √† m√∫sica</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="bg-white rounded-xl shadow-lg mb-6 overflow-hidden tab-container">
            <div class="flex flex-wrap border-b border-gray-100">
                <button data-tab="inicio" class="tab-button flex items-center gap-2 px-6 py-4 font-semibold transition-all text-gray-600 hover:bg-gray-50 tab-active">
                    <span>üè†</span> In√≠cio
                </button>
                <button data-tab="trilha" class="tab-button flex items-center gap-2 px-6 py-4 font-semibold transition-all text-gray-600 hover:bg-gray-50">
                    <span>üìö</span> Trilha
                </button>
                <button data-tab="pratica" class="tab-button flex items-center gap-2 px-6 py-4 font-semibold transition-all text-gray-600 hover:bg-gray-50">
                    <span>üíª</span> Pr√°tica
                </button>
                <button data-tab="progresso" class="tab-button flex items-center gap-2 px-6 py-4 font-semibold transition-all text-gray-600 hover:bg-gray-50">
                    <span>üìä</span> Progresso
                </button>
            </div>
            <div class="p-6 tab-content">
                <div id="inicio-view" class="view view-active space-y-6"></div>
                <div id="trilha-view" class="view space-y-6"></div>
                <div id="pratica-view" class="view space-y-4"></div>
                <div id="progresso-view" class="view"></div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const app = {
        // STATE
        activeTab: 'inicio',
        isAnalyzing: false,
        examDate: new Date('2025-11-03'),
        conversationHistory: [],
        progressData: {},
        topics: {
            p1: [
                { id: 'estruturasCondicionais', nome: 'Estruturas Condicionais', urgencia: 'alta' },
                { id: 'loops', nome: 'Loops (while/for)', urgencia: 'alta' },
                { id: 'funcoes', nome: 'Fun√ß√µes', urgencia: 'alta' },
                { id: 'recursividade', nome: 'Recursividade', urgencia: 'alta' },
                { id: 'vetores', nome: 'Vetores', urgencia: 'alta' },
                { id: 'matrizes', nome: 'Matrizes', urgencia: 'alta' },
                { id: 'strings', nome: 'Strings', urgencia: 'alta' }
            ],
            p2: [
                { id: 'ponteiros', nome: 'Ponteiros', urgencia: 'critica' },
                { id: 'alocacaoDinamica', nome: 'Aloca√ß√£o Din√¢mica', urgencia: 'critica' }
            ]
        },
        lepeesSteps: [
            { id: 'ler', label: 'L', title: 'Ler o problema', type: 'checkbox' },
            { id: 'entender', label: 'E', title: 'Entender (entradas, sa√≠das, regras)', type: 'textarea' },
            { id: 'portugues', label: 'P', title: 'Portugu√™s (pseudoc√≥digo linha por linha)', type: 'textarea' },
            { id: 'estrutura', label: 'E', title: 'Estrutura (vari√°veis, if, loop, fun√ß√£o)', type: 'textarea' },
            { id: 'esqueleto', label: 'Es', title: 'Esqueleto (em C)', type: 'textarea' }
        ],

        // DOM ELEMENTS
        elements: {},

        // INITIALIZATION
        init() {
            this.elements = {
                tabButtons: document.querySelectorAll('.tab-button'),
                views: {
                    inicio: document.getElementById('inicio-view'),
                    trilha: document.getElementById('trilha-view'),
                    pratica: document.getElementById('pratica-view'),
                    progresso: document.getElementById('progresso-view'),
                },
                dateDisplay: document.getElementById('current-date'),
                examCountdown: document.getElementById('exam-countdown'),
            };
            this.setupEventListeners();
            this.loadProgress();
            this.render();
            this.updateDate();
            this.updateCountdown();
        },

        // EVENT LISTENERS
        setupEventListeners() {
            this.elements.tabButtons.forEach(button => {
                button.addEventListener('click', () => this.setActiveTab(button.dataset.tab));
            });
        },
        
        // DATE & COUNTDOWN
        updateDate() {
            const today = new Date();
            this.elements.dateDisplay.textContent = today.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        },

        updateCountdown() {
            const today = new Date();
            const examDay = new Date(this.examDate);
            today.setHours(0, 0, 0, 0);
            examDay.setHours(0, 0, 0, 0);
            const diffTime = examDay - today;
            const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
            let message = '';
            if (diffDays > 1) message = `‚ö†Ô∏è Prova 2 em ${diffDays} dias!`;
            else if (diffDays === 1) message = `‚ö†Ô∏è Prova 2 √© amanh√£!`;
            else if (diffDays === 0) message = `‚ö†Ô∏è Prova 2 √© hoje! Boa sorte!`;
            else message = `Prova 2 j√° passou.`;
            this.elements.examCountdown.textContent = message;
        },

        // STATE MANAGEMENT
        setActiveTab(tabId) {
            this.activeTab = tabId;
            this.render();
        },

        setLoading(button, isLoading, text = 'Analisando...') {
            button.disabled = isLoading;
            const originalText = button.dataset.originalText || button.innerHTML;
            if (isLoading) {
                button.dataset.originalText = originalText;
                button.innerHTML = `<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div> ${text}`;
            } else {
                button.innerHTML = originalText;
            }
        },

        saveProgress() {
            localStorage.setItem('tutorCProgress', JSON.stringify(this.progressData));
        },

        loadProgress() {
            const savedData = localStorage.getItem('tutorCProgress');
            if (savedData) this.progressData = JSON.parse(savedData);
            else {
                 [...this.topics.p1, ...this.topics.p2].forEach(t => {
                     if(this.progressData[t.id] === undefined) this.progressData[t.id] = 0;
                 });
            }
        },

        // RENDERING
        render() {
            Object.values(this.elements.views).forEach(view => view.style.display = 'none');
            this.elements.views[this.activeTab].style.display = 'block';

            this.elements.tabButtons.forEach(button => {
                button.classList.toggle('tab-active', button.dataset.tab === this.activeTab);
            });

            this[`render_${this.activeTab}`]();
        },
        
        render_inicio() {
            this.elements.views.inicio.innerHTML = `
                <!-- Hero Section com V√≠deo -->
                <div class="hero-gradient rounded-2xl p-8 text-white mb-8">
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div>
                            <h2 class="text-4xl font-bold mb-4">Bem-vindo</h2>
                            <p class="text-lg mb-6 opacity-90">Aprenda programa√ß√£o C de forma inteligente e estruturada com o m√©todo LEPEEs, uma acr√¥nimo que inventei para estudar para a prova em vez de estudar para a prova. Que minha procrastina√ß√£o sirva para algo!</p>
                            <div class="flex flex-wrap gap-3">
                                <div class="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
                                    <span class="font-semibold">‚ú® IA Personalizada</span>
                                </div>
                                <div class="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
                                    <span class="font-semibold">üìö M√©todo LEPEEs</span>
                                </div>
                                <div class="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
                                    <span class="font-semibold">ü´ó Beba √°gua!</span>
                                </div>
                                 <div class="bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2">
                                    <span class="font-semibold"><a href="public/desespero.html">Clique aqui se estiver desesperado</a></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Container do V√≠deo com Poster da Britney e Autoplay -->
                        <div class="video-container hero-video">
                            <div class="video-inner">
                                <video id="hero-video" class="w-full aspect-video object-cover" 
                                       controls 
                                       autoplay 
                                       muted
                                       loop
                                       poster="https://media.vanityfair.com/photos/57c04f40daec5e0d4f5d7cf7/16:9/w_1280,c_limit/t-britney-spears-2001-vma-snake.jpg" 
                                       preload="metadata">
                                    <source src="./meu-video.mp4" type="video/mp4">
                                    <source src="./meu-video.webm" type="video/webm">
                                    <source src="./meu-video.mov" type="video/quicktime">
                                    Seu navegador n√£o suporta v√≠deos.
                                </video>
                                <div class="video-overlay"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Features Cards -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="feature-card rounded-xl p-6 shadow-lg border-l-4 border-violet-500">
                        <div class="flex items-center mb-4">
                            <div class="bg-violet-100 p-3 rounded-lg mr-4">
                                <svg class="w-6 h-6 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">M√©todo LEPEEs</h3>
                        </div>
                        <p class="text-gray-600">Estruture seu racioc√≠nio com o acr√¥nimo: <strong>Ler, Entender, Portugu√™s, Estrutura, Esqueleto</strong>.</p>
                    </div>

                    <div class="feature-card rounded-xl p-6 shadow-lg border-l-4 border-blue-500">
                        <div class="flex items-center mb-4">
                            <div class="bg-blue-100 p-3 rounded-lg mr-4">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">IA Personalizada</h3>
                        </div>
                        <p class="text-gray-600">Feedback inteligente e exerc√≠cios gerados especificamente para suas necessidades e n√≠vel de conhecimento.</p>
                    </div>

                    <div class="feature-card rounded-xl p-6 shadow-lg border-l-4 border-green-500">
                        <div class="flex items-center mb-4">
                            <div class="bg-green-100 p-3 rounded-lg mr-4">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">Progresso Visual</h3>
                        </div>
                        <p class="text-gray-600">Monitore seu progresso em tempo real com estat√≠sticas detalhadas de cada t√≥pico estudado.</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-violet-50 border-l-4 border-violet-500 rounded-lg p-6 mb-6">
                    <h3 class="font-bold text-violet-900 mb-4 text-lg">üöÄ A√ß√µes R√°pidas</h3>
                    <div class="grid sm:grid-cols-2 gap-4">
                        <button onclick="app.setActiveTab('trilha')" class="quick-action-btn bg-violet-600 hover:bg-violet-700 text-white font-bold py-4 px-6 rounded-lg transition-all text-left">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">üìö</span>
                                <div>
                                    <div class="font-bold text-lg">Iniciar Trilha de Estudos</div>
                                    <div class="text-sm opacity-90">Explore t√≥picos e gere exerc√≠cios personalizados</div>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="app.setActiveTab('pratica')" class="quick-action-btn bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg transition-all text-left">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">üíª</span>
                                <div>
                                    <div class="font-bold text-lg">Praticar com LEPEEs</div>
                                    <div class="text-sm opacity-90">Use uma metodologia estruturada</div>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- LEPEEs Method Explanation -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üí° Como Funciona o M√©todo LEPEEs?</h3>
                    <div class="grid md:grid-cols-5 gap-4">
                        <div class="text-center p-4 bg-violet-50 rounded-lg">
                            <div class="lepees-label mx-auto mb-2">L</div>
                            <h4 class="font-bold text-sm">Ler</h4>
                            <p class="text-xs text-gray-600">o problema</p>
                        </div>
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="lepees-label mx-auto mb-2" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1d4ed8;">E</div>
                            <h4 class="font-bold text-sm">Entender</h4>
                            <p class="text-xs text-gray-600">entradas/sa√≠das</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="lepees-label mx-auto mb-2" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #166534;">P</div>
                            <h4 class="font-bold text-sm">Portugu√™s</h4>
                            <p class="text-xs text-gray-600">pseudoc√≥digo</p>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="lepees-label mx-auto mb-2" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e;">E</div>
                            <h4 class="font-bold text-sm">Estrutura</h4>
                            <p class="text-xs text-gray-600">vari√°veis/loops</p>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="lepees-label mx-auto mb-2" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b;">Es</div>
                            <h4 class="font-bold text-sm">Esqueleto</h4>
                            <p class="text-xs text-gray-600">c√≥digo em C</p>
                        </div>
                    </div>
                </div>

                <!-- Colab Integration -->
                <div class="bg-orange-50 border-l-4 border-orange-500 rounded-lg p-6">
                    <h3 class="font-bold text-orange-900 mb-3 text-lg">üîß Ambiente de Desenvolvimento</h3>
                    <p class="text-orange-800 mb-4">Compile e teste seus c√≥digos diretamente no Google Colab, utilizando "!" nas c√©lulas para executar.</p>
                    <a href="https://colab.research.google.com/" target="_blank" class="inline-flex items-center bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"></path>
                        </svg>
                        Abrir Google Colab
                    </a>
                </div>
            `;

            // Configurar autoplay robusto do v√≠deo
            setTimeout(() => {
                const video = document.getElementById('hero-video');
                if (video) {
                    // Tentar fazer autoplay
                    video.play().catch(err => {
                        console.log('Autoplay bloqueado pelo navegador. Mostrando poster da Britney.');
                        // Se autoplay falhar, o poster da Britney fica vis√≠vel
                    });

                    // Adicionar evento para unmute quando usu√°rio clicar
                    video.addEventListener('click', () => {
                        if (video.muted) {
                            video.muted = false;
                            video.volume = 0.5; // Volume m√©dio
                        }
                    });

                    // Mostrar dica de √°udio quando hover
                    video.addEventListener('mouseenter', () => {
                        if (video.muted && !video.paused) {
                            video.title = 'Clique para ativar o √°udio';
                        }
                    });
                }
            }, 500);
        },

        render_trilha() {
             const renderTopicList = (title, topics) => `
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-3">${title}</h3>
                    <div class="grid gap-3">
                        ${topics.map(topic => this.renderTopicCard(topic)).join('')}
                    </div>
                </div>`;
            
            this.elements.views.trilha.innerHTML = `
                <div id="loading-exercise" class="hidden bg-blue-50 border-2 border-blue-500 rounded-lg p-4 items-center gap-3">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                    <div>
                        <p class="font-bold text-blue-900">Gerando exerc√≠cio personalizado...</p>
                        <p class="text-sm text-blue-700">A IA est√° criando um desafio para voc√™. Aguarde!</p>
                    </div>
                </div>
                ${renderTopicList('Conte√∫do P1 (Nivelamento)', this.topics.p1)}
                ${renderTopicList('Conte√∫do P2 (Foco Principal)', this.topics.p2)}
            `;
            
            this.elements.views.trilha.querySelectorAll('.practice-button').forEach(button => {
                button.addEventListener('click', (e) => this.generateExercise(e.currentTarget.dataset.topic));
            });
        },
        
        renderTopicCard(topic) {
            const progress = this.progressData[topic.id] || 0;
            const colors = {
                alta: { border: 'border-red-200', bg: 'bg-red-500', button: 'bg-red-500 hover:bg-red-600' },
                critica: { border: 'border-violet-200', bg: 'bg-violet-500', button: 'bg-violet-500 hover:bg-violet-600' }
            };
            const color = colors[topic.urgencia] || colors.alta;

            return `
                <div class="bg-white border-2 ${color.border} rounded-lg p-4">
                    <div class="flex items-center justify-between flex-wrap gap-3">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800">${topic.nome}</h4>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="${color.bg} h-2 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">${progress}%</p>
                        </div>
                        <button data-topic="${topic.nome}" class="practice-button ${color.button} text-white px-4 py-2 rounded-lg flex items-center gap-2 min-w-[120px] justify-center">
                            Praticar
                        </button>
                    </div>
                </div>`;
        },

        render_pratica() {
            this.elements.views.pratica.innerHTML = `
                <div class="bg-white border-2 border-gray-200 rounded-lg p-4">
                    <label class="block font-bold text-gray-800 mb-2">üìù Enunciado do Exerc√≠cio:</label>
                    <textarea id="exercise-input" placeholder="Cole o enunciado aqui ou gere um na aba Trilha..." class="w-full h-24 p-3 border rounded-lg focus:ring-2 focus:ring-violet-500 modern-input"></textarea>
                </div>

                <div class="bg-white border-2 border-gray-200 rounded-lg p-4 space-y-4">
                    <h3 class="text-xl font-bold text-gray-800">Seu Planejamento (LEPEEs)</h3>
                    <div id="lepees-fields" class="space-y-4">${this.renderLepeesFields()}</div>
                    <button id="analyze-plan-button" class="w-full modern-button text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2">Analisar Plano</button>
                </div>
                
                <div class="bg-white border-2 border-gray-200 rounded-lg p-4">
                    <label class="block font-bold text-gray-800 mb-2">üíª Seu C√≥digo C:</label>
                    <textarea id="code-input" placeholder="Ap√≥s a an√°lise do plano, escreva seu c√≥digo aqui..." class="w-full h-56 p-3 border rounded-lg focus:ring-2 focus:ring-violet-500 font-mono text-sm modern-input"></textarea>
                </div>
                <button id="analyze-code-button" class="w-full bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-700 hover:to-indigo-700 text-white font-bold py-4 rounded-lg flex items-center justify-center gap-3 text-lg transition-all">Analisar C√≥digo</button>
                
                <div id="feedback-container" class="space-y-4 mt-6"></div>
                <div id="next-step-container" class="hidden mt-6 bg-white border-2 border-gray-200 rounded-lg p-4 space-y-4"></div>
                <div id="chat-container" class="hidden mt-6 bg-white border-2 border-gray-200 rounded-lg p-4 space-y-4">
                    <h3 class="text-lg font-bold text-gray-800">Converse sobre o Feedback</h3>
                    <div id="chat-messages" class="flex flex-col gap-2 h-48 overflow-y-auto p-2 border rounded-md bg-gray-50"></div>
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" placeholder="Tire sua d√∫vida sobre a an√°lise..." class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-violet-500 modern-input">
                        <button id="chat-send-button" class="modern-button text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">Enviar</button>
                    </div>
                </div>
            `;
            // Re-attach listeners for dynamically created elements
            document.getElementById('analyze-plan-button').addEventListener('click', () => this.analyzePlan());
            document.getElementById('analyze-code-button').addEventListener('click', () => this.analyzeCode());
            document.getElementById('chat-send-button').addEventListener('click', () => this.sendChatMessage());
            document.getElementById('chat-input').addEventListener('keydown', (e) => { if (e.key === 'Enter') this.sendChatMessage(); });
        },

        renderLepeesFields() {
            return this.lepeesSteps.map(step => {
                if (step.type === 'checkbox') {
                    return `<div class="flex items-center gap-4">
                                <span class="lepees-label">${step.label}</span>
                                <div class="w-full flex items-center bg-white p-3 rounded-lg border border-gray-200">
                                    <input id="lepees-${step.id}" type="checkbox" class="h-5 w-5 rounded text-violet-600 focus:ring-violet-500">
                                    <label for="lepees-${step.id}" class="ml-3 block font-bold text-gray-700">${step.title}</label>
                                </div>
                            </div>`;
                } else {
                    return `<div class="flex items-start gap-4">
                                <span class="lepees-label">${step.label}</span>
                                <div class="w-full">
                                    <label class="block font-bold text-gray-700 mb-1">${step.title}</label>
                                    <textarea id="lepees-${step.id}" class="w-full h-20 p-2 border rounded-lg focus:ring-2 focus:ring-violet-500 modern-input"></textarea>
                                </div>
                            </div>`;
                }
            }).join('');
        },
        
        render_progresso() {
            const allTopics = [...this.topics.p1, ...this.topics.p2];
            this.elements.views.progresso.innerHTML = allTopics.map(topic => {
                const progress = this.progressData[topic.id] || 0;
                return `<div class="bg-white border-2 border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex justify-between mb-2">
                                <h4 class="font-bold">${topic.nome}</h4>
                                <span class="text-sm font-semibold">${progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-violet-500 to-indigo-500 h-3 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                        </div>`;
            }).join('');
        },

        renderFeedback(htmlContent, color = 'gray') {
            const container = document.getElementById('feedback-container');
            if(container) {
                const card = document.createElement('div');
                card.className = `border-l-4 p-4 rounded bg-${color}-50 border-${color}-500 prose max-w-none`;
                card.innerHTML = htmlContent;
                container.innerHTML = '';
                container.appendChild(card);
            }
        },

        addChatMessage(message, role) {
            const chatMessages = document.getElementById('chat-messages');
            if(chatMessages) {
                const bubble = document.createElement('div');
                bubble.className = `chat-bubble ${role}`;
                // Usar o converter global do showdown
                const converter = new showdown.Converter();
                bubble.innerHTML = converter.makeHtml(message);
                chatMessages.appendChild(bubble);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        },

        renderNextStep(assessment) {
            const container = document.getElementById('next-step-container');
            if (!container) return;

            container.innerHTML = '';
            container.classList.remove('hidden');

            const messageEl = document.createElement('p');
            messageEl.className = 'text-center font-medium text-gray-700';
            messageEl.textContent = assessment.message;
            container.appendChild(messageEl);
            
            if (assessment.nextAction === 'REDO') {
                const redoButton = document.createElement('button');
                redoButton.className = 'w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors';
                redoButton.textContent = 'Ok, vou tentar corrigir!';
                redoButton.onclick = () => container.classList.add('hidden');
                container.appendChild(redoButton);
            } else {
                 const btn_reinforce = document.createElement('button');
                 btn_reinforce.className = 'w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors';
                 btn_reinforce.textContent = 'Gerar Exerc√≠cio Similar';
                 btn_reinforce.onclick = () => this.generateExercise(assessment.topicName, 'normal');
                 container.appendChild(btn_reinforce);

                if (assessment.nextAction === 'PROCEED') {
                    const btn_proceed = document.createElement('button');
                    btn_proceed.className = 'w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg mt-2 transition-colors';
                    btn_proceed.textContent = 'Gerar Pr√≥ximo Exerc√≠cio (N√≠vel Acima)';
                    btn_proceed.onclick = () => this.generateExercise(assessment.topicName, 'dificil');
                    container.appendChild(btn_proceed);
                }
            }
        },
        
        // API CALLS
        async callApi(endpoint, body) {
            try {
                
                // Timeout de 45 segundos para requisi√ß√µes
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 45000);
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Erro HTTP ${response.status}`);
                }
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error(`‚ùå Erro na chamada da API para ${endpoint}:`, error);
                
                let errorMessage = 'Erro desconhecido';
                if (error.name === 'AbortError') {
                    errorMessage = 'Timeout: A requisi√ß√£o demorou muito para responder. Verifique sua conex√£o.';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                alert(`Ocorreu um erro: ${errorMessage}. Tente novamente.`);
                return null;
            }
        },

        async generateExercise(topicName, difficulty = 'normal') {
            const button = document.querySelector(`.practice-button[data-topic="${topicName}"]`);
            if (button) this.setLoading(button, true, '');
            
            const nextStepContainer = document.getElementById('next-step-container');
            if (nextStepContainer) {
                nextStepContainer.innerHTML = `<div class="text-center font-bold">Gerando novo exerc√≠cio...</div>`;
            }

            const data = await this.callApi('/api/generate-exercise', { topicName, difficulty });

            if (button) this.setLoading(button, false);

            if (data) {
                
                // Limpar containers que podem existir
                const feedbackContainer = document.getElementById('feedback-container');
                const chatContainer = document.getElementById('chat-container');
                if (feedbackContainer) feedbackContainer.innerHTML = '';
                if (chatContainer) chatContainer.classList.add('hidden');
                if (nextStepContainer) nextStepContainer.classList.add('hidden');
                
                this.conversationHistory = [];
                
                // Primeiro mudar para a aba pr√°tica para renderizar os elementos
                this.setActiveTab('pratica');
                
                // Aguardar um pouco para os elementos serem renderizados
                setTimeout(() => {
                    // Agora definir os valores nos elementos
                    const exerciseInput = document.getElementById('exercise-input');
                    const codeInput = document.getElementById('code-input');
                    
                    if (exerciseInput) {
                        exerciseInput.value = data.enunciado || '';
                    }
                    if (codeInput) {
                        codeInput.value = data.prototipo || '';
                    }
                    
                    // Limpar campos LEPEEs
                    this.lepeesSteps.forEach(step => {
                        const el = document.getElementById(`lepees-${step.id}`);
                        if (el) {
                           if (step.type === 'checkbox') el.checked = false;
                           else el.value = '';
                        }
                    });
                }, 100);
            }
        },

        async analyzePlan() {
             const button = document.getElementById('analyze-plan-button');
             if (!button) return;
             
             this.setLoading(button, true, 'Analisando Plano...');
             
             const exerciseInput = document.getElementById('exercise-input');
             if (!exerciseInput) {
                 alert('Elemento n√£o encontrado. Recarregue a p√°gina.');
                 this.setLoading(button, false);
                 return;
             }
             
             const exercise = exerciseInput.value.trim();
             if (!exercise) {
                 alert('Por favor, cole o enunciado do exerc√≠cio primeiro.');
                 this.setLoading(button, false);
                 return;
             }
             
             const lepeesData = this.lepeesSteps.reduce((acc, step) => {
                 const el = document.getElementById(`lepees-${step.id}`);
                 if (el) {
                     acc[step.id] = (step.type === 'checkbox') ? (el.checked ? "Sim, li o problema." : "N√£o marquei que li o problema.") : el.value.trim();
                 }
                 return acc;
             }, {});

             const data = await this.callApi('/api/analyze-plan', { exercise, lepeesData });
             this.setLoading(button, false);
             if (data) {
                 this.renderFeedback(data.feedbackHtml, data.readyToCode ? 'green' : 'yellow');
             }
        },

        async analyzeCode() {
            const button = document.getElementById('analyze-code-button');
            if (!button) return;
            
            this.setLoading(button, true, 'Analisando C√≥digo...');

            const exerciseInput = document.getElementById('exercise-input');
            const codeInput = document.getElementById('code-input');
            const chatContainer = document.getElementById('chat-container');
            const chatMessages = document.getElementById('chat-messages');
            const nextStepContainer = document.getElementById('next-step-container');
            
            if (!exerciseInput || !codeInput) {
                alert('Elementos n√£o encontrados. Recarregue a p√°gina.');
                this.setLoading(button, false);
                return;
            }

            if (this.conversationHistory.length === 0) {
                 if (chatContainer) chatContainer.classList.add('hidden');
                 if (chatMessages) chatMessages.innerHTML = '';
                 if (nextStepContainer) nextStepContainer.classList.add('hidden');
                 this.conversationHistory.push({ role: 'user', parts: [{ text: `Exerc√≠cio: "${exerciseInput.value.trim()}"` }] });
            }
            
            const userPrompt = `Meu c√≥digo (vers√£o atual):\n\`\`\`c\n${codeInput.value.trim()}\n\`\`\`\n\nPor favor, analise-o novamente, considerando nosso hist√≥rico.`;
            this.conversationHistory.push({ role: 'user', parts: [{ text: userPrompt }] });

            const data = await this.callApi('/api/analyze-code', { 
                exercise: exerciseInput.value.trim(), 
                code: codeInput.value.trim(),
                history: this.conversationHistory
            });
            this.setLoading(button, false);

            if (data) {
                this.conversationHistory.push({ role: 'model', parts: [{ text: JSON.stringify(data) }] }); // Store raw response for context
                const isCorrect = data.assessment.nextAction !== 'REDO';
                this.renderFeedback(data.feedbackHtml, isCorrect ? 'green' : 'red');
                if (chatContainer) chatContainer.classList.remove('hidden');
                this.renderNextStep(data.assessment);

                if(isCorrect && data.assessment.topicId && this.progressData.hasOwnProperty(data.assessment.topicId)) {
                    this.progressData[data.assessment.topicId] = Math.min(100, (this.progressData[data.assessment.topicId] || 0) + 25);
                    this.saveProgress();
                }
            }
        },
        
        async sendChatMessage() {
            const chatInput = document.getElementById('chat-input');
            const chatSendButton = document.getElementById('chat-send-button');
            const userText = chatInput.value.trim();
            if(!userText) return;

            this.addChatMessage(userText, 'user');
            chatInput.value = '';
            chatInput.disabled = true;
            chatSendButton.disabled = true;

            this.conversationHistory.push({ role: 'user', parts: [{ text: userText }] });
            const data = await this.callApi('/api/chat', { history: this.conversationHistory });
            
            chatInput.disabled = false;
            chatSendButton.disabled = false;
            
            if(data) {
                this.conversationHistory.push({ role: 'model', parts: [{ text: data.replyHtml }] });
                this.addChatMessage(data.replyHtml, 'model');
            }
        }
    };

    // Exponha o app globalmente para acessar nos event handlers
    window.app = app;
    app.init();
});
</script>
</body>
</html>
